// Generated by CoffeeScript 1.4.0
(function() {
  var App;

  App = Ember.Application.create({
    map: null,
    exchangesList: null,
    buildings: null,
    getSlug: function(model) {
      var slug;
      if (!model.slug) {
        slug = model;
      } else {
        slug = model.slug;
      }
      return slug;
    }
  });

  App.deferReadiness();

  jQuery.getJSON(IxMap.Map.buildingsGeojson, function(data) {
    App.buildings = new GeoJSON(data);
    return App.advanceReadiness();
  });

  App.ApplicationView = Ember.View.extend({
    classNames: ['google-map']
  });

  App.Router.map(function() {
    this.route("internet-exchange", {
      path: "/internet-exchange/"
    });
    this.route("internet-exchange", {
      path: "/internet-exchange/:slug"
    });
    this.route("building", {
      path: "/building/"
    });
    return this.route("building", {
      path: "/building/:slug"
    });
  });

  App.IndexRoute = Ember.Route.extend({
    setupController: function(controller, model) {
      if (!App.exchangesList) {
        App.exchangesList = IxMap.Map.showAllExchanges();
        return controller.set("model", App.exchangesList);
      } else {
        return controller.set("model", App.exchangesList);
      }
    }
  });

  App.InternetExchangeRoute = Ember.Route.extend({
    setupController: function(controller, model) {
      return jQuery.getJSON("api/internet-exchanges/" + (App.getSlug(model)) + ".js", function(data) {
        return controller.set("model", data);
      });
    }
  });

  App.BuildingRoute = Ember.Route.extend({
    setupController: function(controller, model) {
      return jQuery.getJSON("api/buildings/" + (App.getSlug(model)) + ".js", function(data) {
        return controller.set("model", data);
      });
    }
  });

  App.IndexView = Ember.View.extend({
    listItemView: Ember.View.extend({
      templateName: 'exchange-list-item'
    }),
    didInsertElement: function() {
      if (!App.map) {
        return App.set('map', new IxMap.Map('map', new google.maps.LatLng(30.0, -30.0), 3, App.buildings));
      } else {
        return App.map.showAllBuildings();
      }
    }
  });

  App.InternetExchangeController = Ember.ObjectController.extend({});

  App.BuildingView = Ember.View.extend({
    buildingView: Ember.View.extend({
      templateName: 'building-address-view'
    }),
    willRerender: function() {
      return App.map.lookupBuildingForMap(this.get('controller.model'));
    },
    didInsertElement: function() {
      if (!App.map) {
        App.set('map', new IxMap.Map('map', new google.maps.LatLng(30.0, -30.0), 3, App.buildings));
        return App.map.lookupBuildingForMap(App.getSlug(this.get('controller.model')));
      } else {
        return App.map.lookupBuildingForMap(App.getSlug(this.get('controller.model')));
      }
    }
  });

  App.InternetExchangeView = Ember.View.extend({
    listItemView: Ember.View.extend({
      templateName: 'building-address',
      tagName: "span",
      mouseEnter: function(e) {
        if (jQuery(e.target).context.tagName === "A") {
          return App.map.highlightExchangeBuildingFromList(jQuery(e.target).attr('href').split("/")[2]);
        }
      },
      mouseLeave: function(e) {
        return App.map.infoBox.close();
      }
    }),
    willRerender: function() {
      return App.map.lookupExchangeForMap(this.get('controller.model'));
    },
    didInsertElement: function() {
      if (!App.map) {
        App.set('map', new IxMap.Map('map', new google.maps.LatLng(30.0, -30.0), 3, App.buildings));
        return App.map.lookupExchangeForMap(App.getSlug(this.get('controller.model')));
      } else {
        return App.map.lookupExchangeForMap(App.getSlug(this.get('controller.model')));
      }
    }
  });

}).call(this);
